!function(t,e){if("function"==typeof define&&define.amd)define(["module","exports"],e);else if("undefined"!=typeof exports)e(module,exports);else{var n={exports:{}};e(n,n.exports),t.BlurTool=n.exports}}(this,function(t,e){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"object"!==(void 0===e?"undefined":a(e)))throw new Error("Input must be a Object");this._config=i({},{target:null,brushSize:5,radius:10,sigma:15},e),this._isInit=!1,this.init()}return o(t,[{key:"init",value:function(){var t=this._config,e="string"==typeof t.target&&document.querySelector(t.target);e?(this._isInit=!0,this._target=e,this._imgDisplay=e.style.display,this._width=e.width,this._height=e.height,this._canvas=document.createElement("canvas"),this._canvasCtx=this._canvas.getContext("2d"),this._canvas.setAttribute("width",this._width),this._canvas.setAttribute("height",this._height),this._arrPaint=[],e.addEventListener("load",this.draw(),!1),e.src=e.src):console.error("目标图片不存在,请检查configs.target是否填写正确")}},{key:"draw",value:function(){var t=this;console.log(this._isInit);var e=this._canvas,i=this._canvasCtx,a=document.createElement("canvas"),o=a.getContext("2d"),r=[[0,0],[this._width,this._height]];a.setAttribute("width",this._width),a.setAttribute("height",this._height),a.style.display="none",i.drawImage.apply(i,[this._target].concat(n(r[0]),n(r[1])));var s=i.getImageData.apply(i,n(r[0]).concat(n(r[1]))),u=o.createImageData.apply(o,n(r[1]));u=this.gaussBlur(s),o.putImageData.apply(o,[u].concat(n(r[0])));var c=new Image;c.src=a.toDataURL("image/png"),c.onload=function(){i.lineWidth=t._config.brushSize,i.lineCap="round",i.strokeStyle=i.createPattern(c,"repeat"),t._target.style.display="none",t._target.after(e),t.mouseEvent()}}},{key:"canvasPaint",value:function(){var t=this._arrPaint,e=this._canvasCtx;if(e){if(e.beginPath(),e.moveTo(t[0][0],t[0][1]),1==t.length)e.lineTo(t[0][0]+1,t[0][1]+1);else{var n=1;for(n in t)e.lineTo(t[n][0],t[n][1]),e.moveTo(t[n][0],t[n][1])}e.closePath(),e.stroke()}}},{key:"mouseEvent",value:function(){var t=this,e=0,n=0,i=!1;this._canvas.onmousedown=function(a){i=!0,n=a.offsetX,e=a.offsetY,t._arrPaint.push([n,e]),t.canvasPaint()},this._canvas.onmouseup=function(e){i=!1,t._arrPaint=[]},this._canvas.onmousemove=function(a){i&&(n=a.offsetX,e=a.offsetY,t._arrPaint.push([n,e]),t.canvasPaint())}}},{key:"gaussBlur",value:function(t){var e=t.data,n=t.width,i=t.height,a=[],o=0,r=void 0,s=void 0,u=void 0,c=void 0,h=void 0,f=void 0,l=void 0,v=void 0,d=void 0,g=void 0,p=this._config.radius;for(f=1/(15*Math.sqrt(2*Math.PI)),h=-1/450,l=0,r=-p;r<=p;r++,l++)c=f*Math.exp(h*r*r),a[l]=c,o+=c;for(l=0,g=a.length;l<g;l++)a[l]/=o;for(s=0;s<i;s++)for(r=0;r<n;r++){for(u=c=h=f=0,o=0,v=-p;v<=p;v++)(d=r+v)>=0&&d<n&&(u+=e[l=4*(s*n+d)]*a[v+p],c+=e[l+1]*a[v+p],h+=e[l+2]*a[v+p],o+=a[v+p]);e[l=4*(s*n+r)]=u/o,e[l+1]=c/o,e[l+2]=h/o}for(r=0;r<n;r++)for(s=0;s<i;s++){for(u=c=h=f=0,o=0,v=-p;v<=p;v++)(d=s+v)>=0&&d<i&&(u+=e[l=4*(d*n+r)]*a[v+p],c+=e[l+1]*a[v+p],h+=e[l+2]*a[v+p],o+=a[v+p]);e[l=4*(s*n+r)]=u/o,e[l+1]=c/o,e[l+2]=h/o}return t}}]),t}();e.default=r,t.exports=e.default});