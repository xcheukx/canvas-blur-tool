!function(t,e){if("function"==typeof define&&define.amd)define(["module"],e);else if("undefined"!=typeof exports)e(module);else{var i={exports:{}};e(i),t.jqueryBlurtool=i.exports}}(this,function(t){"use strict";!function(e,i,n,s){var o=function(t){var e=n.extend({target:null,brushSize:5},t);this.configs=e,console.log(this.configs),this.init(e||{})};o.prototype={constructor:o,init:function(t){var e="string"==typeof t.target&&i.getElementById(t.target);if(e){this.orginImgDisplay=e.style.display,this.width=e.width,this.height=e.height;var n=this.canvas_=i.createElement("canvas");n.setAttribute("width",this.width),n.setAttribute("height",this.height);e.addEventListener("load",this.draw(e),!1),e.src=e.src}else console.error("目标图片不存在,请检查configs.target是否填写正确")},draw:function(t){var e=this.canvas_,n=i.createElement("canvas"),s=n.getContext("2d"),o=e.getContext("2d");n.setAttribute("width",this.width),n.setAttribute("height",this.height),n.style.display="none",o.drawImage(t,0,0,this.width,this.height);var a=o.getImageData(0,0,this.width,this.height),r=s.createImageData(this.width,this.height);r=this.gaussBlur(a),s.putImageData(r,0,0);var h=new Image;h.src=n.toDataURL("image/png");var f=this;h.onload=function(){function i(){if(o.beginPath(),o.moveTo(n[0][0],n[0][1]),1==n.length)o.lineTo(n[0][0]+1,n[0][1]+1);else{var t=1;for(t in n)o.lineTo(n[t][0],n[t][1]),o.moveTo(n[t][0],n[t][1])}o.closePath(),o.stroke()}o.lineWidth=f.configs.brushSize,o.lineCap="round",o.strokeStyle=o.createPattern(h,"repeat"),t.style.display="none",t.after(e);var n=[],s=0,a=0,r=!1;e.onmousedown=function(t){r=!0,a=t.offsetX,s=t.offsetY,n.push([a,s]),i()},e.onmouseup=function(t){r=!1,n=[]},e.onmousemove=function(t){r&&(a=t.offsetX,s=t.offsetY,n.push([a,s]),i())}}},setBrush:function(t){var e=this.canvas_.getContext("2d");return e.lineWidth=e.lineWidth+t,e.lineWidth},save:function(){return this.canvas_.toDataURL("image/png")},clear:function(){var t=i.getElementById(this.configs.target);this.canvas_.getContext("2d").drawImage(t,0,0,this.width,this.height)},reset:function(){var t=i.getElementById(this.configs.target);t?(t.style.display=this.orginImgDisplay,t.removeEventListener("load",this.draw(t),!1),this.canvas_.parentNode.removeChild(this.canvas_),delete this.canvas_,this.init(this.configs)):console.error("目标图片不存在,请检查configs.target是否填写正确")},gaussBlur:function(t){var e,i,n,s,o,a,r,h,f,d,g=t.data,c=t.width,u=t.height,l=[],v=0;for(a=1/(15*Math.sqrt(2*Math.PI)),o=-1/450,r=0,e=-100;e<=100;e++,r++)s=a*Math.exp(o*e*e),l[r]=s,v+=s;for(r=0,d=l.length;r<d;r++)l[r]/=v;for(i=0;i<u;i++)for(e=0;e<c;e++){for(n=s=o=a=0,v=0,h=-100;h<=100;h++)(f=e+h)>=0&&f<c&&(n+=g[r=4*(i*c+f)]*l[h+100],s+=g[r+1]*l[h+100],o+=g[r+2]*l[h+100],v+=l[h+100]);g[r=4*(i*c+e)]=n/v,g[r+1]=s/v,g[r+2]=o/v}for(e=0;e<c;e++)for(i=0;i<u;i++){for(n=s=o=a=0,v=0,h=-100;h<=100;h++)(f=i+h)>=0&&f<u&&(n+=g[r=4*(f*c+e)]*l[h+100],s+=g[r+1]*l[h+100],o+=g[r+2]*l[h+100],v+=l[h+100]);g[r=4*(i*c+e)]=n/v,g[r+1]=s/v,g[r+2]=o/v}return t}},void 0!==t&&t.exports&&(t.exports=o),"function"==typeof define&&define(function(){return o}),e.BlurTool=o}(window,document,jQuery)});